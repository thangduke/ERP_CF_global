<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data noupdate="0">
        <record id="module_category_order_management" model="ir.module.category">
            <field name="name">Ứng dụng Đơn Hàng</field>
            <field name="description">Quản lý đơn hàng, Style, vật tư,...</field>
            <field name="sequence">10</field>
            <!-- <field name="module">order_management</field>  --> <!-- Gỡ dòng này -->
        </record>

        <record id="group_order_management_user" model="res.groups">
            <field name="name">Người dùng</field>
            <field name="category_id" ref="order_management.module_category_order_management"/>
            <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        </record>

        <record id="group_order_management_manager" model="res.groups">
            <field name="name">Quản trị viên</field>
            <field name="category_id" ref="order_management.module_category_order_management"/>
            <field name="implied_ids" eval="[(4, ref('order_management.group_order_management_user'))]"/>
        </record>
        

<!--######## MODEL WARE HOUSE ###### -->
        <!-- TH1  (người tạo ,duyệt và theo dõi) là nhóm user Đơn hàng có quyền đọc, tạo, xóa -->
        <record id="rule_warehouse_order_user_edit" model="ir.rule">
            <field name="name">Warehouse Order: User can edit if creator/manager/follower</field>
            <field name="model_id" ref="model_warehouse_order"/>
            <field name="domain_force">
                ['|','|','|',
                    ('employee_id.user_id','=',user.id),
                    ('manager_ids.user_id','=',user.id),
                    ('department_approval_id.user_id','=',user.id),
                    ('follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH2  (không phải người tạo ,duyệt và theo dõi) là nhóm user Đơn hàng có quyền đọc, không có quyền tạo, xóa -->
        <record id="rule_warehouse_order_user_read" model="ir.rule">
            <field name="name">Warehouse Order: User can read all</field>
            <field name="model_id" ref="model_warehouse_order"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_warehouse_order_manager_full" model="ir.rule">
            <field name="name">Warehouse Order: Manager full access</field>
            <field name="model_id" ref="model_warehouse_order"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>


<!--######## MODEL PRODUCT  CODE ###### -->

        <!-- TH1: User có quyền edit nếu là người tạo/duyệt/theo dõi của warehouse_order -->
        <record id="rule_product_code_user_edit" model="ir.rule">
            <field name="name">Product Code: User can edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_product_code"/>
            <field name="domain_force">
                ['|','|','|',
                    ('warehouse_order_id.employee_id.user_id','=',user.id),
                    ('warehouse_order_id.manager_ids.user_id','=',user.id),
                    ('warehouse_order_id.department_approval_id.user_id','=',user.id),
                    ('warehouse_order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: User không liên quan vẫn có thể đọc, nhưng không được tạo/sửa/xóa -->
        <record id="rule_product_code_user_read" model="ir.rule">
            <field name="name">Product Code: User can only read if not related</field>
            <field name="model_id" ref="model_product_code"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_product_code_manager_full" model="ir.rule">
            <field name="name">Product Code: Manager full access</field>
            <field name="model_id" ref="model_product_code"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
<!-- QUYỀN TRÊN PRODUCT.COLOR.SIZE -->
<!-- ================================================== -->

        <!-- TH1: Người tạo, người duyệt, người theo dõi được đọc + ghi + xóa -->
        <record id="rule_product_color_size_owner" model="ir.rule">
            <field name="name">Product Color Size: Owner/Manager can read/write</field>
            <field name="model_id" ref="model_product_color_size"/>
            <field name="domain_force">
                ['|','|','|',
                    ('warehouse_order_id.employee_id.user_id','=',user.id),
                    ('warehouse_order_id.manager_ids.user_id','=',user.id),
                    ('warehouse_order_id.department_approval_id.user_id','=',user.id),
                    ('warehouse_order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_product_color_size_user_read" model="ir.rule">
            <field name="name">Product Color Size: User can read all</field>
            <field name="model_id" ref="model_product_color_size"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_product_color_size_manager_full" model="ir.rule">
            <field name="name">Warehouse Order: Manager full access</field>
            <field name="model_id" ref="model_product_color_size"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

<!-- QUYỀN TRÊN material_purchase_order -->
<!-- ================================================== -->

        <!-- TH1: Người tạo, người duyệt, người theo dõi được đọc + ghi + xóa -->
        <record id="rule_material_purchase_order_edit_related" model="ir.rule">
            <field name="name">material_purchase_order: Edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_material_purchase_order"/>
            <field name="domain_force">
                ['|','|','|',
                    ('order_id.employee_id.user_id','=',user.id),
                    ('order_id.manager_ids.user_id','=',user.id),
                    ('order_id.department_approval_id.user_id','=',user.id),
                    ('order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_material_purchase_order_user_read" model="ir.rule">
            <field name="name">material_purchase_order: User can read all</field>
            <field name="model_id" ref="model_material_purchase_order"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_material_purchase_order_manager_full" model="ir.rule">
            <field name="name">Warehouse Order: Manager full access</field>
            <field name="model_id" ref="model_material_purchase_order"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>
<!-- QUYỀN TRÊN material.invoice -->
<!-- ================================================== -->

        <!-- TH1: Người tạo, người duyệt, người theo dõi được đọc + ghi + xóa -->
        <record id="rule_material_invoice_edit_related" model="ir.rule">
            <field name="name">material.invoice: Edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_material_invoice"/>
            <field name="domain_force">
                ['|','|','|',
                    ('order_id.employee_id.user_id','=',user.id),
                    ('order_id.manager_ids.user_id','=',user.id),
                    ('order_id.department_approval_id.user_id','=',user.id),
                    ('order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_material_invoice_user_read" model="ir.rule">
            <field name="name">material.invoice: User can read all</field>
            <field name="model_id" ref="model_material_invoice"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_material_invoice_order_manager_full" model="ir.rule">
            <field name="name">Warehouse Order: Manager full access</field>
            <field name="model_id" ref="model_material_invoice"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!--TH4 Nhân viên kho (warehouse_pro) có toàn quyền trên tất cả các bản ghi invoice -->
        <record id="rule_material_invoice_warehouse_user_full" model="ir.rule">
            <field name="name">Material Invoice: Warehouse User full access</field>
            <field name="model_id" ref="model_material_invoice"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('warehouse_pro.group_warehouse_pro_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

<!-- QUYỀN TRÊN PRICE CALCULATION -->
<!-- ================================================== -->
        <!-- TH1: Người tạo, người duyệt, người theo dõi được đọc + ghi + xóa -->
        <record id="rule_product_price_calculation_edit_related" model="ir.rule">
            <field name="name">product.price.calculation: Edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_product_price_calculation"/>
            <field name="domain_force">
                ['|','|','|',
                    ('warehouse_order_id.employee_id.user_id','=',user.id),
                    ('warehouse_order_id.manager_ids.user_id','=',user.id),
                    ('warehouse_order_id.department_approval_id.user_id','=',user.id),
                    ('warehouse_order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_product_price_calculation_user_read" model="ir.rule">
            <field name="name">product.price.calculation: User can read all</field>
            <field name="model_id" ref="model_product_price_calculation"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>
        <!-- TH3 Quản trị viên có toàn quyền trên tất cả các bản ghi -->
        <record id="rule_product_price_calculation_order_manager_full" model="ir.rule">
            <field name="name">product.price.calculation: Manager full access</field>
            <field name="model_id" ref="model_product_price_calculation"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_manager'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- ================================================== -->
        <!--   Phân quyền cho wizard Create Style Color Size   -->
        <!-- ================================================== -->
        <!-- TH1: Người tạo, người duyệt, người theo dõi được toàn quyền -->
        <record id="rule_create_style_color_size_wizard_edit_related" model="ir.rule">
            <field name="name">create.style.color.size.wizard: Edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_create_style_color_size_wizard"/>
            <field name="domain_force">
                ['|','|','|',
                    ('warehouse_order_id.employee_id.user_id','=',user.id),
                    ('warehouse_order_id.manager_ids.user_id','=',user.id),
                    ('warehouse_order_id.department_approval_id.user_id','=',user.id),
                    ('warehouse_order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_create_style_color_size_wizard_user_read" model="ir.rule">
            <field name="name">create.style.color.size.wizard: User can read all</field>
            <field name="model_id" ref="model_create_style_color_size_wizard"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

        <!-- ================================================== -->
        <!--   Phân quyền cho wizard Apply Material            -->
        <!-- ================================================== -->
        <!-- TH1: Người tạo, người duyệt, người theo dõi được toàn quyền -->
        <record id="rule_apply_material_wizard_edit_related" model="ir.rule">
            <field name="name">apply.material.style.color.size.wizard: Edit if related to Warehouse Order</field>
            <field name="model_id" ref="model_apply_material_style_color_size_wizard"/>
            <field name="domain_force">
                ['|','|','|',
                    ('warehouse_order_id.employee_id.user_id','=',user.id),
                    ('warehouse_order_id.manager_ids.user_id','=',user.id),
                    ('warehouse_order_id.department_approval_id.user_id','=',user.id),
                    ('warehouse_order_id.follow_ids.user_id','=',user.id)
                ]
            </field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_create" eval="True"/>
            <field name="perm_unlink" eval="True"/>
        </record>

        <!-- TH2: Nhóm user bình thường: chỉ có quyền đọc -->
        <record id="rule_apply_material_wizard_user_read" model="ir.rule">
            <field name="name">apply.material.style.color.size.wizard: User can read all</field>
            <field name="model_id" ref="model_apply_material_style_color_size_wizard"/>
            <field name="domain_force">[(1,'=',1)]</field>
            <field name="groups" eval="[(4, ref('order_management.group_order_management_user'))]"/>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="False"/>
            <field name="perm_create" eval="False"/>
            <field name="perm_unlink" eval="False"/>
        </record>

    </data>
</odoo>
